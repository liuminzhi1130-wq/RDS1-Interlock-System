<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RDS é€£é–é‚è¼¯æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-color: #e0e5ec;
            --text-main: #4a5568;
            --text-highlight: #2d3748;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --accent-color: #667eea;
            --trip-color: #e53e3e;   /* è·³è»Šç´… */
            --mech-color: #d69e2e;   /* æ©Ÿæ¢°å› ç´ é»ƒ */
            --proc-color: #3182ce;   /* è£½ç¨‹å› ç´ è— */
        }

        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 3px; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: manipulation;
        }

        h1 {
            color: var(--text-highlight);
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
            text-shadow: 1px 1px 1px #fff;
        }

        #app-container {
            width: 100%;
            max-width: 600px;
            background: var(--bg-color);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 12px 12px 24px var(--shadow-dark), 
                       -12px -12px 24px var(--shadow-light);
            min-height: 85vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* æŒ‰éˆ•å…±ç”¨æ¨£å¼ */
        .btn {
            border: none;
            outline: none;
            background: var(--bg-color);
            color: var(--text-main);
            font-size: 1.1rem;
            font-weight: 600;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 6px 6px 12px var(--shadow-dark), 
                       -6px -6px 12px var(--shadow-light);
            transition: transform 0.1s ease;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            cursor: pointer;
            box-sizing: border-box;
        }
        .btn:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark), 
                        inset -4px -4px 8px var(--shadow-light);
            transform: scale(0.98);
        }

        .btn-icon {
            font-size: 1.6rem;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .btn-text { flex-grow: 1; }
        .arrow { color: var(--accent-color); font-weight: 900; font-size: 1.2rem; }

        /* åˆ†é¡æŒ‰éˆ•ç‰¹åˆ¥è‰² */
        .btn-process { border-left: 5px solid var(--proc-color); }
        .btn-mech { border-left: 5px solid var(--mech-color); }

        /* æœå°‹æ¡† */
        .search-box {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 50px;
            background: var(--bg-color);
            box-shadow: inset 5px 5px 10px var(--shadow-dark), 
                        inset -5px -5px 10px var(--shadow-light);
            font-size: 1rem;
            margin-bottom: 20px;
            color: var(--text-highlight);
            box-sizing: border-box;
        }
        .search-box:focus { outline: none; border: 1px solid var(--accent-color); }

        /* è¡¨æ ¼å®¹å™¨ */
        .detail-card {
            background: var(--bg-color);
            border-radius: 20px;
            padding: 15px;
            box-shadow: inset 4px 4px 8px var(--shadow-dark), 
                        inset -4px -4px 8px var(--shadow-light);
            overflow-x: auto;
            flex-grow: 1;
        }

        table { width: 100%; border-collapse: collapse; min-width: 300px; }
        th { text-align: left; color: var(--accent-color); padding: 12px 8px; font-size: 0.95rem; border-bottom: 2px solid #cbd5e0; white-space: nowrap; }
        td { padding: 12px 8px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 0.95rem; vertical-align: top; }
        
        .tag-no { color: var(--accent-color); font-family: 'Consolas', monospace; font-weight: 700; display: block; margin-top: 4px; font-size: 0.9rem; }
        .value { color: var(--trip-color); font-weight: 700; display: block; margin-top: 4px; }
        .type-badge { font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; color: #fff; margin-right: 5px; display: inline-block; margin-bottom: 4px;}

        .btn-back { margin-bottom: 15px; padding: 12px; text-align: center; display: block; color: var(--accent-color); font-weight: bold; border: 1px solid transparent; }
        
        /* Master Map ç›¸é—œ */
        .map-container-wrapper { flex-grow: 1; display: flex; flex-direction: column; }
        .map-controls { display: flex; justify-content: center; gap: 20px; margin-bottom: 10px; z-index: 10; }
        .zoom-btn {
            width: 45px; height: 45px; border-radius: 50%; border: none;
            background: var(--bg-color);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            font-weight: bold; font-size: 1.5rem; color: var(--accent-color); cursor: pointer;
        }
        .zoom-btn:active { box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light); }
        .mermaid-container {
            flex-grow: 1; overflow: auto; border-radius: 20px; padding: 0;
            background: #eef2f7;
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            display: flex; align-items: flex-start; justify-content: center;
        }

        /* æœå°‹çµæœ */
        .search-result-item {
            background: var(--bg-color); margin-bottom: 15px; padding: 15px;
            border-radius: 15px; box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            border-left: 6px solid var(--accent-color); cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>RDS é€£é–ç³»çµ±</h1>

    <div id="app-container">
        <div id="display-area" style="width: 100%; height: 100%; display: flex; flex-direction: column;">
            </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'base', 
            securityLevel: 'loose',
            flowchart: { curve: 'basis', htmlLabels: true, useMaxWidth: false },
            themeVariables: { primaryColor: '#e0e5ec', primaryTextColor: '#2d3748', lineColor: '#667eea', fontSize: '20px', fontFamily: 'arial' } 
        });

        // ==========================================
        // è³‡æ–™åº«ï¼šå€åˆ† Process (è£½ç¨‹) èˆ‡ Mechanical (æ©Ÿæ¢°)
        // ==========================================
        const db = {
            "Compressor": {
                "C-2001A": {
                    "hasSub": true,
                    "Process": [
                        [cite_start]{ reason: "D-2010 é«˜é«˜æ¶²ä½", tag: "LSHH-403 A/B/C", value: "-", logic: "3é¸2 (Common) [cite: 11]" },
                        [cite_start]{ reason: "å…è¨±é–‹è»Šä¹‹ 9 é¡† S.W é–‹é—œ", tag: "-", value: "å•Ÿå‹•å¾Œ 60s å…§æœ‰æ•ˆ", logic: "é€£é–è·³è»Š [cite: 12]" },
                        { reason: "ä¸€ç´šé€²å£ä½ä½å£“åŠ›", tag: "PSLL-603 A/B/C", value: "14.8 kg/cmÂ²", logic: "3é¸2" },
                        { reason: "ä¸€ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-397 A/B/C", value: "149Â°C", logic: "3é¸2" },
                        { reason: "äºŒç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-398 A/B/C", value: "149Â°C", logic: "3é¸2" },
                        { reason: "ä¸‰ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-399 A/B/C", value: "149Â°C", logic: "3é¸2" },
                        { reason: "D-2012A é«˜é«˜æ¶²ä½", tag: "LSHH-408", value: "-", logic: "" },
                        { reason: "D-2013A é«˜é«˜æ¶²ä½", tag: "LSHH-410", value: "-", logic: "" }
                    ],
                    "Mechanical": [
                        { reason: "æ©Ÿæ¶æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-768", value: "1.7 kg/cmÂ²", logic: "" },
                        { reason: "æ³¨æ²¹å™¨ä½æ¶²é¢", tag: "LALL-566", value: "3.5 kg/cmÂ²", logic: "" },
                        { reason: "æº«æ°´å£“åŠ›ä½", tag: "PALL-774", value: "1.76 kg/cmÂ²", logic: "" },
                        { reason: "ä¸»é¦¬é”ç·šåœˆæº«åº¦é«˜", tag: "TAHH-496 B/D/F", value: "140Â°C", logic: "" },
                        { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-955 A/B", value: "æ§åˆ¶å®¤/L.P", logic: "" }
                    ]
                },
                "C-2001B": {
                    "hasSub": true,
                    "Process": [
                        [cite_start]{ reason: "D-2010 é«˜é«˜æ¶²ä½", tag: "LSHH-403 A/B/C", value: "-", logic: "3é¸2 (Common) [cite: 11]" },
                        [cite_start]{ reason: "å…è¨±é–‹è»Šä¹‹ 9 é¡† S.W é–‹é—œ", tag: "-", value: "å•Ÿå‹•å¾Œ 60s å…§æœ‰æ•ˆ", logic: "é€£é–è·³è»Š [cite: 12]" },
                        { reason: "ä¸€ç´šé€²å£ä½ä½å£“åŠ›", tag: "PSLL-612 A/B/C", value: "14.8 kg/cmÂ²", logic: "3é¸2" },
                        { reason: "ä¸€ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-400 A/B/C", value: "149Â°C", logic: "3é¸2" },
                        { reason: "äºŒç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-401 A/B/C", value: "149Â°C", logic: "3é¸2" },
                        { reason: "ä¸‰ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-402 A/B/C", value: "149Â°C", logic: "3é¸2" },
                        { reason: "D-2012A é«˜é«˜æ¶²ä½", tag: "LSHH-415", value: "-", logic: "" },
                        { reason: "D-2013A é«˜é«˜æ¶²ä½", tag: "LSHH-417", value: "-", logic: "" }
                    ],
                    "Mechanical": [
                        { reason: "æ©Ÿæ¶æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-769", value: "1.7 kg/cmÂ²", logic: "" },
                        { reason: "æ³¨æ²¹å™¨ä½æ¶²é¢", tag: "LALL-567", value: "3.5 kg/cmÂ²", logic: "" },
                        { reason: "æº«æ°´å£“åŠ›ä½", tag: "PALL-775", value: "1.76 kg/cmÂ²", logic: "" },
                        { reason: "ä¸»é¦¬é”ç·šåœˆæº«åº¦é«˜", tag: "TAHH-497 B/D/F", value: "140Â°C", logic: "" },
                        { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-959 A/B", value: "æ§åˆ¶å®¤/L.P", logic: "" }
                    ]
                },
                "C-2001C": {
                    "hasSub": true,
                    "Process": [
                        [cite_start]{ reason: "D-2010 é«˜é«˜æ¶²ä½", tag: "LSHH-403 A/B/C", value: "-", logic: "3é¸2 (Common) [cite: 11]" },
                        [cite_start]{ reason: "å…è¨±é–‹è»Šä¹‹ 9 é¡† S.W é–‹é—œ", tag: "-", value: "å•Ÿå‹•å¾Œ 60s å…§æœ‰æ•ˆ", logic: "é€£é–è·³è»Š [cite: 12]" },
                        { reason: "ä¸€ç´šé€²å£ä½ä½å£“åŠ›", tag: "PSLL-620 A/B/C", value: "14.8 kg/cmÂ²", logic: "3é¸2" },
                        { reason: "å„ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-403~405", value: "149Â°C", logic: "3é¸2" },
                        { reason: "D-2012A é«˜é«˜æ¶²ä½", tag: "LSHH-422", value: "-", logic: "" },
                        { reason: "D-2013A é«˜é«˜æ¶²ä½", tag: "LSHH-424", value: "-", logic: "" }
                    ],
                    "Mechanical": [
                        { reason: "æ©Ÿæ¶æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-770", value: "1.7 kg/cmÂ²", logic: "" },
                        { reason: "æ³¨æ²¹å™¨ä½æ¶²é¢", tag: "LALL-568", value: "3.5 kg/cmÂ²", logic: "" },
                        { reason: "æº«æ°´å£“åŠ›ä½", tag: "PALL-776", value: "1.76 kg/cmÂ²", logic: "" },
                        { reason: "ä¸»é¦¬é”ç·šåœˆæº«åº¦é«˜", tag: "TAHH-498 B/D/F", value: "140Â°C", logic: "" },
                        { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-963 A/B", value: "æ§åˆ¶å®¤/L.P", logic: "" }
                    ]
                },
                "C-2002": {
                    "hasSub": true,
                    "Process": [
                        { reason: "å‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-406 A/B/C", value: "193Â°C", logic: "3é¸2" },
                        { reason: "å‡ºå£ä½ä½æµé‡", tag: "FSLL-140 A/B/C", value: "100 MÂ³/H", logic: "3é¸2 (Overrideå¯)" },
                        { reason: "D-2014 é«˜é«˜æ¶²ä½", tag: "LSHH-479", value: "-", logic: "3é¸2" },
                        { reason: "é€²å£ä½ä½å£“åŠ›", tag: "PSLL-654 A/B/C", value: "0.14 kg/cmÂ²", logic: "3é¸2" },
                        { reason: "D-2005 é«˜é«˜æ¶²ä½", tag: "LSHH-455", value: "-", logic: "3é¸2 (ä¸é€£é–å…¶ä»–)" }
                    ],
                    "Mechanical": [
                        { reason: "æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-791", value: "0.56 kg/cmÂ²", logic: "Delay 1s" },
                        { reason: "é ‚éƒ¨å¯†å°æ²¹æ§½æ¶²é¢ä½", tag: "LALL-556", value: "2502mm", logic: "Topèµ·, Delay 1s" },
                        { reason: "å¯†å°æ²¹/æ°£å·®å£“ä½", tag: "DPALL-786", value: "0.21 kg/cmÂ²", logic: "Delay 1s" },
                        { reason: "è½‰è»¸å¾‘å‘é«˜éœ‡å‹•", tag: "Vib High", value: "63.5 um", logic: "Delay 1s" },
                        { reason: "è½‰è»¸è»¸å‘é«˜ä½ç§»", tag: "Disp High", value: "304.8 um", logic: "Delay 1s" },
                        { reason: "è¶…é€Ÿè·³è»Š", tag: "Overspeed", value: "12628 rpm", logic: "" },
                        { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-906", value: "æ§åˆ¶å®¤", logic: "" }
                    ]
                },
                "C-2003A": {
                    "hasSub": true,
                    "Process": [
                        { reason: "D-2014 é«˜é«˜æ¶²ä½", tag: "LSHH-479 A/B/C", value: "-", logic: "3é¸2 (Common)" },
                        { reason: "ç¬¬ä¸€ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-408", value: "140Â°C", logic: "" },
                        { reason: "ç¬¬äºŒç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-419", value: "99Â°C", logic: "" },
                        { reason: "é€²å£ä½ä½å£“åŠ›", tag: "PSLL-654 A/B/C", value: "0.14 kg/cmÂ²", logic: "3é¸2" },
                        { reason: "D-2034A é«˜é«˜æ¶²ä½", tag: "LSHH-528", value: "-", logic: "" }
                    ],
                    "Mechanical": [
                        { reason: "æ›²è»¸ç®±æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-838", value: "0.35 kg/cmÂ²", logic: "" },
                        { reason: "æ³¨æ²¹å™¨æ¶²é¢ä½", tag: "LALL-579", value: "3.52 kg/cmÂ²", logic: "" },
                        { reason: "æº«æ°´å£“åŠ›ä½", tag: "PALL-840", value: "0.35 kg/cmÂ²", logic: "" },
                        { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-938A", value: "æ§åˆ¶å®¤", logic: "" }
                    ]
                },
                "C-2003B": {
                    "hasSub": true,
                    "Process": [
                        { reason: "D-2014 é«˜é«˜æ¶²ä½", tag: "LSHH-479 A/B/C", value: "-", logic: "3é¸2 (Common)" },
                        { reason: "ç¬¬ä¸€ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-409", value: "140Â°C", logic: "" },
                        { reason: "ç¬¬äºŒç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-420", value: "99Â°C", logic: "" },
                        { reason: "é€²å£ä½ä½å£“åŠ›", tag: "PSLL-656 A/B/C", value: "0.14 kg/cmÂ²", logic: "3é¸2" },
                        { reason: "D-2034B é«˜é«˜æ¶²ä½", tag: "LSHH-531", value: "-", logic: "" }
                    ],
                    "Mechanical": [
                        { reason: "æ›²è»¸ç®±æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-839", value: "0.35 kg/cmÂ²", logic: "" },
                        { reason: "æ³¨æ²¹å™¨æ¶²é¢ä½", tag: "LALL-580", value: "3.52 kg/cmÂ²", logic: "" },
                        { reason: "æº«æ°´å£“åŠ›ä½", tag: "PALL-841", value: "0.35 kg/cmÂ²", logic: "" },
                        { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-930A", value: "æ§åˆ¶å®¤", logic: "" }
                    ]
                },
                "C-2004": { "hasSub": false, "list": [
                    { reason: "å‡ºå£ä½å£“åŠ›", tag: "PSL-681", value: "50 mmH2O", logic: "Auto Start å‚™ç”¨æ³µ" }
                ]},
                "C-2005": { "hasSub": false, "list": [
                    { reason: "é€²å‡ºå£é«˜å·®å£“", tag: "PDSLL-733 A/B/C", value: "80 mmH2O", logic: "è§¸ç™¼é–‹å•ŸXV-941" },
                    { reason: "C-2005 è·³è»Š", tag: "Timer", value: "5 sec", logic: "XV-941æœªå…¨é–‹å‰‡è·³è»Š" }
                ]}
            },
            "Furnace": {
                "F-2001": { "hasSub": false, "list": [
                    { reason: "F.G ä½å£“åŠ›", tag: "PSLL-713 A/B/C", value: "0.07 kg/cmÂ²", logic: "4é¸2" },
                    { reason: "ç©ºæ°£ä½æµé‡", tag: "FSLL-081 A/B/C", value: "5000 NMÂ³/h", logic: "" },
                    { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-995 A/B", value: "æ§åˆ¶å®¤", logic: "" }
                ]},
                "F-2002": { "hasSub": false, "list": [
                    { reason: "F.G ä½å£“åŠ›", tag: "PSLL-715 A/B/C", value: "0.17 kg/cmÂ²", logic: "4é¸2" },
                    { reason: "ç©ºæ°£ä½æµé‡", tag: "FSLL-085 A/B/C", value: "1500 NMÂ³/h", logic: "" },
                    { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-988 A/B", value: "æ§åˆ¶å®¤", logic: "" }
                ]}
            },
            "Pump": {
                // Pump é¡åˆ¥å› ç‚ºè·³è»Šé»å°‘ï¼Œä¿æŒå–®é é¡¯ç¤ºï¼Œä½†åœ¨è¡¨æ ¼å…§å€åˆ†
                "P-2001A/B": { "hasSub": false, "list": [
                    { reason: "æ»‘æ²¹ä½ä½å£“åŠ›", tag: "PSLL-798(A)/800(B)", value: "0.98/0.7 kg/cmÂ²", logic: "3é¸2" },
                    { reason: "é¦¬é”ç·šåœˆé«˜æº«åº¦", tag: "TSHH-464/466", value: "160Â°C", logic: "B/D/F" }
                ]},
                "P-2002A/B": { "hasSub": false, "list": [
                    { reason: "æ»‘æ²¹ä½ä½å£“åŠ›", tag: "PSLL-802(A)/804(B)", value: "0.98/0.84 kg/cmÂ²", logic: "3é¸2" },
                    { reason: "é¦¬é”ç·šåœˆé«˜æº«åº¦", tag: "TSHH-468/470", value: "160Â°C", logic: "B/D/F" }
                ]},
                "P-2003A/B": { "hasSub": false, "list": [
                    { reason: "æ»‘æ²¹ä½ä½å£“åŠ›", tag: "PSLL-806(A)/808(B)", value: "0.77/0.7 kg/cmÂ²", logic: "3é¸2" },
                    { reason: "é¦¬é”ç·šåœˆé«˜æº«åº¦", tag: "TSHH-472/474", value: "160Â°C", logic: "" }
                ]},
                "P-2016A/B": { "hasSub": false, "list": [ { reason: "å‡ºå£ä½å£“åŠ›", tag: "PSL-711", value: "3.2 kg/cmÂ²", logic: "Auto Start" } ]},
                "P-2017A/B": { "hasSub": false, "list": [ { reason: "å‡ºå£ä½å£“åŠ›", tag: "PSL-709", value: "5 kg/cmÂ²", logic: "Auto Start" } ]},
                "P-2021A/B": { "hasSub": false, "list": [ { reason: "æ»‘æ²¹ä½ä½å£“åŠ›", tag: "PSLL-813B/815B", value: "0.7 kg/cmÂ²", logic: "Delay 60s" } ]}
            }
        };

        const appDiv = document.getElementById('display-area');
        let currentZoom = 1.3;

        // é¦–é 
        function renderHome() {
            let html = '<div style="flex-grow:1; display:flex; flex-direction:column; gap:15px;">';
            html += `<button class="btn" onclick="renderSearchPage()">
                        <div class="btn-icon">ğŸ”</div>
                        <div class="btn-text">æœå°‹è³‡æ–™ (Search)</div>
                        <div class="arrow">âœ</div>
                     </button>`;
            html += `<button class="btn" onclick="renderMasterMap()">
                        <div class="btn-icon">ğŸ•¸ï¸</div>
                        <div class="btn-text">é€£é–å› æœç¸½è¡¨ (Master Map)</div>
                        <div class="arrow">âœ</div>
                     </button>`;
            
            const icons = { 'Compressor': 'âš™ï¸', 'Furnace': 'ğŸ”¥', 'Pump': 'ğŸ’§' };
            Object.keys(db).forEach(category => {
                html += `<button class="btn" onclick="renderCategory('${category}')">
                            <div class="btn-icon">${icons[category]}</div>
                            <div class="btn-text">${category}</div>
                            <div class="arrow">âœ</div>
                         </button>`;
            });
            html += '</div>';
            appDiv.innerHTML = html;
        }

        // è¨­å‚™åˆ†é¡åˆ—è¡¨
        function renderCategory(category) {
            let html = `<button class="btn btn-back" onclick="renderHome()"> â† è¿”å›ä¸»é¸å–® </button>`;
            html += `<h2 style="text-align:center; color:var(--text-highlight);">${category}</h2>`;
            html += '<div style="display:flex; flex-direction:column; gap:15px;">';
            Object.keys(db[category]).forEach(equipment => {
                html += `<button class="btn" onclick="renderDetails('${category}', '${equipment}')">
                            <div class="btn-text">${equipment}</div>
                            <div class="arrow">âœ</div>
                         </button>`;
            });
            html += '</div>';
            appDiv.innerHTML = html;
        }

        // è¨­å‚™è©³æƒ…è™•ç†ï¼ˆåˆ¤æ–·æ˜¯å¦éœ€è¦åˆ†æµï¼‰
        function renderDetails(category, equipment) {
            const equipData = db[category][equipment];
            
            // å¦‚æœè©²è¨­å‚™æœ‰å€åˆ† Process/Mechanical å­é¸å–®
            if (equipData.hasSub) {
                renderSubSelection(category, equipment);
            } else {
                // æ²’æœ‰å­é¸å–®ï¼Œç›´æ¥é¡¯ç¤ºåˆ—è¡¨
                renderTable(category, equipment, equipData.list, null);
            }
        }

        // æ¸²æŸ“å­é¸å–® (è£½ç¨‹ vs æ©Ÿæ¢°)
        function renderSubSelection(category, equipment) {
            let html = `<button class="btn btn-back" onclick="renderCategory('${category}')"> â† è¿”å› ${category} </button>`;
            html += `<h2 style="text-align:center; color:var(--text-highlight);">${equipment} è·³è»Šé¡å‹é¸æ“‡</h2>`;
            html += `<div style="display:flex; flex-direction:column; gap:20px; margin-top:20px;">`;
            
            html += `<button class="btn btn-process" onclick="renderSubTable('${category}', '${equipment}', 'Process')">
                        <div class="btn-icon">ğŸ­</div>
                        <div class="btn-text">è£½ç¨‹é€£é–è·³è»Š (Process Trip)</div>
                        <div class="arrow">âœ</div>
                     </button>`;
                     
            html += `<button class="btn btn-mech" onclick="renderSubTable('${category}', '${equipment}', 'Mechanical')">
                        <div class="btn-icon">ğŸ› ï¸</div>
                        <div class="btn-text">æ©Ÿæ¢°å› ç´ è·³è»Š (Mechanical Trip)</div>
                        <div class="arrow">âœ</div>
                     </button>`;
            
            html += `</div>`;
            appDiv.innerHTML = html;
        }

        // æ¸²æŸ“æœ€çµ‚è¡¨æ ¼ (æ”¯æ´å­é¡å‹)
        function renderSubTable(category, equipment, type) {
            const data = db[category][equipment][type];
            renderTable(category, equipment, data, type);
        }

        function renderTable(category, equipment, dataList, subType) {
            // æ±ºå®šè¿”å›æŒ‰éˆ•çš„ç›®æ¨™
            let backAction = "";
            let title = equipment;
            
            if (subType) {
                // å¦‚æœæ˜¯å­é é¢ï¼Œè¿”å›åˆ°é¸æ“‡é 
                backAction = `renderSubSelection('${category}', '${equipment}')`;
                title += ` - ${subType === 'Process' ? 'è£½ç¨‹é€£é–' : 'æ©Ÿæ¢°å› ç´ '}`;
            } else {
                // å¦‚æœæ˜¯å–®é é¢ï¼Œè¿”å›åˆ°è¨­å‚™åˆ—è¡¨
                backAction = `renderCategory('${category}')`;
            }

            let html = `<button class="btn btn-back" onclick="${backAction}"> â† è¿”å›ä¸Šä¸€é  </button>`;
            html += `<div class="detail-card">`;
            html += `<h3 style="color:var(--text-highlight); border-bottom: 2px solid var(--accent-color); padding-bottom:15px; margin-top:0;">
                        ${title}
                     </h3>`;
            html += `<table>
                        <thead>
                            <tr>
                                <th width="45%">è·³è»Šå› ç´ </th>
                                <th width="35%">ä½è™Ÿ / è¨­å®š</th>
                                <th width="20%">é‚è¼¯/å‚™è¨»</th>
                            </tr>
                        </thead>
                        <tbody>`;
            
            dataList.forEach(item => {
                html += `<tr>
                            <td>${item.reason}</td>
                            <td>
                                <span class="tag-no">${item.tag}</span>
                                <span class="value">${item.value}</span>
                            </td>
                            <td style="font-size:0.9rem; color:#718096;">${item.logic}</td>
                         </tr>`;
            });
            html += `</tbody></table></div>`;
            appDiv.innerHTML = html;
        }

        // Master Map (ä¿æŒé‚è¼¯ä¸è®Šï¼Œä¿®æ­£ç‰ˆ)
        function renderMasterMap() {
            currentZoom = 1.3;
            let html = `<div class="map-container-wrapper">`;
            html += `<button class="btn btn-back" onclick="renderHome()"> â† è¿”å›ä¸»é¸å–® </button>`;
            html += `<div class="map-controls">
                        <button class="zoom-btn" onclick="zoomMap(0.2)">+</button>
                        <button class="zoom-btn" onclick="zoomMap(-0.2)">-</button>
                     </div>`;
            html += `
            <div class="mermaid-container">
                <div class="mermaid" id="mermaid-graph" style="transform: scale(${currentZoom}); transform-origin: top center; transition: transform 0.3s; padding: 20px;">
                    graph TD
                        classDef root fill:#2d3748,stroke:#1a202c,stroke-width:3px,color:#fff;
                        classDef main fill:#e53e3e,stroke:#c53030,stroke-width:3px,color:#fff,font-weight:bold;
                        classDef sub fill:#ed8936,stroke:#c05621,stroke-width:2px,color:#fff;
                        classDef final fill:#fc8181,stroke:#c53030,stroke-width:2px,color:#fff;

                        MCC[MCC 480V è·³é›»]:::root -->|Delay 3s| C2002((C-2002 S/D)):::main
                        C2002 -->|é€£é–| F2001[F-2001 ç†„ç«]:::sub
                        C2002 -->|é€£é–| F2002[F-2002 ç†„ç«]:::sub
                        C2002 -->|é€£é–| APH[APH è·³è»Š]:::sub
                        C2002 -->|å£“å·®é‚è¼¯| C2005[C-2005 è·³è»Š]:::sub
                        C2005 -.->|XV-941æœªå…¨é–‹| C2005_Trip[C-2005 S/D]
                        F2001 -->|é€£é–| P2001[P-2001 A/B S/D]:::final
                        
                        linkStyle default stroke:#667eea,stroke-width:3px;
                </div>
            </div>`;
            html += `</div>`;
            appDiv.innerHTML = html;
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        }

        function zoomMap(delta) {
            currentZoom += delta;
            if (currentZoom < 0.5) currentZoom = 0.5;
            if (currentZoom > 3) currentZoom = 3;
            document.getElementById('mermaid-graph').style.transform = `scale(${currentZoom})`;
        }

        // æœå°‹åŠŸèƒ½
        function renderSearchPage() {
            let html = `<button class="btn btn-back" onclick="renderHome()"> â† è¿”å›ä¸»é¸å–® </button>`;
            html += `<input type="text" id="searchInput" class="search-box" placeholder="è¼¸å…¥ä½è™Ÿã€è¨­å‚™åæˆ–æ•¸å€¼..." onkeyup="performSearch()">`;
            html += `<div id="searchResults"></div>`;
            appDiv.innerHTML = html;
            document.getElementById('searchInput').focus();
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value.toUpperCase().trim();
            const resultsDiv = document.getElementById('searchResults');
            if (query.length < 2) { resultsDiv.innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">è«‹è¼¸å…¥è‡³å°‘ 2 å€‹å­—å…ƒ...</div>'; return; }

            let matches = [];
            Object.keys(db).forEach(cat => {
                Object.keys(db[cat]).forEach(equip => {
                    const obj = db[cat][equip];
                    // è™•ç†æœ‰å­é¸å–®çš„æƒ…æ³
                    if (obj.hasSub) {
                        ['Process', 'Mechanical'].forEach(subType => {
                            obj[subType].forEach(item => {
                                if ((item.reason && item.reason.includes(query)) || (item.tag && item.tag.includes(query)) || (item.value && item.value.includes(query)) || equip.includes(query)) {
                                    matches.push({ equip: equip, cat: cat, type: subType, item: item });
                                }
                            });
                        });
                    } else {
                        // è™•ç†ç„¡å­é¸å–®çš„æƒ…æ³
                        obj.list.forEach(item => {
                            if ((item.reason && item.reason.includes(query)) || (item.tag && item.tag.includes(query)) || (item.value && item.value.includes(query)) || equip.includes(query)) {
                                matches.push({ equip: equip, cat: cat, type: 'General', item: item });
                            }
                        });
                    }
                });
            });

            if (matches.length === 0) {
                resultsDiv.innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">æŸ¥ç„¡è³‡æ–™</div>';
            } else {
                let html = '';
                matches.slice(0, 50).forEach(m => { // é™åˆ¶é¡¯ç¤ºæ•¸é‡å„ªåŒ–æ•ˆèƒ½
                    let typeLabel = m.type === 'Process' ? 'ğŸ­ è£½ç¨‹' : (m.type === 'Mechanical' ? 'ğŸ› ï¸ æ©Ÿæ¢°' : 'ä¸€èˆ¬');
                    let clickAction = m.type === 'General' ? `renderDetails('${m.cat}', '${m.equip}')` : `renderSubTable('${m.cat}', '${m.equip}', '${m.type}')`;
                    
                    html += `<div class="search-result-item" onclick="${clickAction}">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <span style="font-weight:bold; color:var(--text-highlight); font-size:1.1rem;">${m.equip}</span>
                                    <span style="font-size:0.8rem; background:#cbd5e0; padding:2px 8px; border-radius:10px;">${typeLabel}</span>
                                </div>
                                <div style="margin-top:5px; color:#4a5568;">
                                    ${m.item.reason} <span class="tag-no">${m.item.tag}</span>
                                </div>
                             </div>`;
                });
                resultsDiv.innerHTML = html;
            }
        }

        renderHome();
    </script>
</body>
</html>
