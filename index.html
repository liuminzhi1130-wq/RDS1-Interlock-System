<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RDS é€£é–é‚è¼¯æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-color: #e0e5ec;
            --text-main: #4a5568;
            --text-highlight: #2d3748;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --accent-color: #667eea;
            --trip-color: #e53e3e;
        }

        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ (ç¾è§€) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* é˜²æ­¢æ‰‹æ©Ÿé›™æ“Šç¸®æ”¾ */
            touch-action: manipulation;
        }

        h1 {
            color: var(--text-highlight);
            font-weight: 300;
            letter-spacing: 1px;
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.5rem;
        }

        #app-container {
            width: 100%;
            max-width: 600px; /* é‡å°æ‰‹æ©Ÿå„ªåŒ–å¯¬åº¦ */
            background: var(--bg-color);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 10px 10px 30px var(--shadow-dark), 
                       -10px -10px 30px var(--shadow-light);
            min-height: 600px;
            position: relative;
        }

        /* å‚ç›´é¸å–®ä½ˆå±€ */
        .vertical-menu {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* æŒ‰éˆ•æ¨£å¼ (Neumorphism) */
        .btn {
            border: none;
            outline: none;
            background: var(--bg-color);
            color: var(--text-main);
            font-size: 1.1rem;
            font-weight: 600;
            padding: 25px 20px; /* å¢åŠ é«˜åº¦ä¾¿æ–¼æ‰‹æ©Ÿé»æ“Š */
            border-radius: 15px;
            box-shadow: 6px 6px 12px var(--shadow-dark), 
                       -6px -6px 12px var(--shadow-light);
            transition: all 0.2s ease;
            width: 100%;
            text-align: left; /* ç›´åˆ—å¼æ–‡å­—é å·¦æ¯”è¼ƒå¥½çœ‹ */
            display: flex;
            align-items: center;
            position: relative;
            cursor: pointer;
        }

        .btn:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark), 
                        inset -4px -4px 8px var(--shadow-light);
            transform: scale(0.98);
        }

        .btn-icon {
            font-size: 1.8rem;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .btn-text {
            flex-grow: 1;
        }

        .arrow {
            color: var(--accent-color);
            font-weight: bold;
        }

        /* æœå°‹æ¡†æ¨£å¼ */
        .search-box {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 50px;
            background: var(--bg-color);
            box-shadow: inset 4px 4px 8px var(--shadow-dark), 
                        inset -4px -4px 8px var(--shadow-light);
            font-size: 1rem;
            margin-bottom: 20px;
            color: var(--text-highlight);
            box-sizing: border-box; /* é˜²æ­¢è¶…å‡ºå¯¬åº¦ */
        }
        .search-box:focus {
            outline: none;
            box-shadow: inset 6px 6px 12px var(--shadow-dark), 
                        inset -6px -6px 12px var(--shadow-light);
        }

        /* è¡¨æ ¼èˆ‡å¡ç‰‡ */
        .detail-card {
            background: var(--bg-color);
            border-radius: 15px;
            padding: 15px;
            box-shadow: inset 3px 3px 6px var(--shadow-dark), 
                        inset -3px -3px 6px var(--shadow-light);
            overflow-x: auto; /* å…è¨±è¡¨æ ¼æ°´å¹³æ»‘å‹• */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 300px; /* é˜²æ­¢è¡¨æ ¼åœ¨å°è¢å¹•ç¸®å¤ªå° */
        }

        th {
            text-align: left;
            color: var(--accent-color);
            padding: 12px 8px;
            font-size: 0.9rem;
            border-bottom: 2px solid #ccc;
        }

        td {
            padding: 12px 8px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            font-size: 0.95rem;
        }

        .tag-no { color: var(--accent-color); font-family: monospace; font-weight: bold; display: block; margin-top: 4px; }
        .value { color: var(--trip-color); font-weight: bold; display: block; margin-top: 4px; }

        /* Master Map ç¸®æ”¾æ§åˆ¶ */
        .map-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--bg-color);
            box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--text-main);
        }
        .zoom-btn:active {
            box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light);
        }

        .mermaid-container {
            overflow: auto;
            border-radius: 10px;
            padding: 10px;
            height: 500px; /* å›ºå®šé«˜åº¦è®“å·è»¸å‡ºç¾ */
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        /* æœå°‹çµæœçš„é«˜äº® */
        .search-result-item {
            background: var(--bg-color);
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
            border-left: 5px solid var(--accent-color);
        }

        .btn-back {
            margin-bottom: 20px;
            padding: 15px;
            text-align: center;
            display: block;
            color: var(--accent-color);
        }

    </style>
</head>
<body>

    <h1>RDS é€£é–ç³»çµ±</h1>

    <div id="app-container">
        <div id="display-area">
            </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'base', 
            securityLevel: 'loose',
            themeVariables: { primaryColor: '#e0e5ec', primaryTextColor: '#4a5568', lineColor: '#667eea', fontSize: '18px' } 
        });

        // è³‡æ–™åº«
        const db = {
            "Compressor": {
                "C-2001A": [
                    { reason: "ä¸€ç´šé€²å£ä½ä½å£“åŠ›", tag: "PSLL-603 A/B/C", value: "14.8 kg/cmÂ²", logic: "3é¸2" },
                    { reason: "ä¸€ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-397 A/B/C", value: "149Â°C", logic: "3é¸2" },
                    { reason: "æ©Ÿæ¶æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-768", value: "1.7 kg/cmÂ²", logic: "" },
                    { reason: "æ³¨æ²¹å™¨ä½æ¶²é¢", tag: "LALL-566", value: "3.5 kg/cmÂ²", logic: "" },
                    { reason: "ä¸»é¦¬é”ç·šåœˆæº«åº¦é«˜", tag: "TAHH-496 B/D/F", value: "140Â°C", logic: "" },
                    { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-955 A/B", value: "æ§åˆ¶å®¤/L.P", logic: "" }
                ],
                "C-2001B": [
                    { reason: "ä¸€ç´šé€²å£ä½ä½å£“åŠ›", tag: "PSLL-612 A/B/C", value: "14.8 kg/cmÂ²", logic: "3é¸2" },
                    { reason: "ä¸€ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-400 A/B/C", value: "149Â°C", logic: "3é¸2" },
                    { reason: "æ©Ÿæ¶æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-769", value: "1.7 kg/cmÂ²", logic: "" },
                    { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-959 A/B", value: "æ§åˆ¶å®¤/L.P", logic: "" }
                ],
                "C-2001C": [
                    { reason: "ä¸€ç´šé€²å£ä½ä½å£“åŠ›", tag: "PSLL-620 A/B/C", value: "14.8 kg/cmÂ²", logic: "3é¸2" },
                    { reason: "æ©Ÿæ¶æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-770", value: "1.7 kg/cmÂ²", logic: "" },
                    { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-963 A/B", value: "æ§åˆ¶å®¤/L.P", logic: "" }
                ],
                "C-2002": [
                    { reason: "å‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-406 A/B/C", value: "193Â°C", logic: "3é¸2" },
                    { reason: "å‡ºå£ä½ä½æµé‡", tag: "FSLL-140 A/B/C", value: "100 MÂ³/H", logic: "3é¸2 (å¯Override)" },
                    { reason: "æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-791", value: "0.56 kg/cmÂ²", logic: "Delay 1 sec" },
                    { reason: "å¯†å°æ²¹/æ°£å·®å£“ä½", tag: "DPALL-786", value: "0.21 kg/cmÂ²", logic: "Delay 1 sec" },
                    { reason: "D-2014 é«˜é«˜æ¶²ä½", tag: "LSHH-479", value: "-", logic: "3é¸2" },
                    { reason: "é€²å£ä½ä½å£“åŠ›", tag: "PSLL-654 A/B/C", value: "0.14 kg/cmÂ²", logic: "3é¸2" },
                    { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-906", value: "æ§åˆ¶å®¤", logic: "" }
                ],
                "C-2003": [
                    { reason: "ç¬¬ä¸€ç´šå‡ºå£é«˜é«˜æº«åº¦", tag: "TSHH-408(A)/409(B)", value: "140Â°C", logic: "" },
                    { reason: "é€²å£ä½ä½å£“åŠ›", tag: "PSLL-656 A/B/C", value: "0.14 kg/cmÂ²", logic: "3é¸2" },
                    { reason: "æ›²è»¸ç®±æ»‘æ²¹å£“åŠ›ä½", tag: "PALL-838(A)/839(B)", value: "0.35 kg/cmÂ²", logic: "" }
                ],
                "C-2004": [
                    { reason: "å‡ºå£ä½å£“åŠ›", tag: "PSL-681", value: "50 mmH2O", logic: "D-2002ç›¸é—œ" },
                    { reason: "D-2002 ä½ä½æ¶²ä½", tag: "LSLL-429 A/B/C", value: "-", logic: "3é¸2" }
                ],
                "C-2005": [
                    { reason: "é€²å‡ºå£é«˜å·®å£“", tag: "PDSLL-733 A/B/C", value: "80 mmH2O", logic: "è§¸ç™¼å¾Œé–‹å•Ÿ XV-941" },
                    { reason: "C-2005 è·³è»Š", tag: "-", value: "XV-941é–‹å•Ÿ5ç§’å¾Œè‹¥æœªå…¨é–‹", logic: "å»¶é²è·³è»Š" }
                ]
            },
            "Furnace": {
                "F-2001": [
                    { reason: "F.G ä½å£“åŠ›", tag: "PSLL-713 A/B/C", value: "0.07 kg/cmÂ²", logic: "4é¸2" },
                    { reason: "ç©ºæ°£ä½æµé‡", tag: "FSLL-081 A/B/C", value: "5000 NMÂ³/h", logic: "" },
                    { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-995 A/B", value: "æ§åˆ¶å®¤", logic: "" }
                ],
                "F-2002": [
                    { reason: "F.G ä½å£“åŠ›", tag: "PSLL-715 A/B/C", value: "0.17 kg/cmÂ²", logic: "4é¸2" },
                    { reason: "ç©ºæ°£ä½æµé‡", tag: "FSLL-085 A/B/C", value: "1500 NMÂ³/h", logic: "" },
                    { reason: "æ‰‹å‹•è·³è»ŠæŒ‰éˆ•", tag: "HS-988 A/B", value: "æ§åˆ¶å®¤", logic: "" }
                ]
            },
            "Pump": {
                "P-2001A/B": [ { reason: "æ»‘æ²¹ä½ä½å£“åŠ›", tag: "PSLL-798(A)/800(B)", value: "0.98/0.7 kg/cmÂ²", logic: "3é¸2" } ],
                "P-2002A/B": [ { reason: "æ»‘æ²¹ä½ä½å£“åŠ›", tag: "PSLL-802(A)/804(B)", value: "0.98/0.84 kg/cmÂ²", logic: "3é¸2" } ],
                "P-2003A/B": [ { reason: "æ»‘æ²¹ä½ä½å£“åŠ›", tag: "PSLL-806(A)/808(B)", value: "0.77/0.7 kg/cmÂ²", logic: "3é¸2" } ],
                "P-2016A/B": [ { reason: "å‡ºå£ä½å£“åŠ›", tag: "PSL-711", value: "3.2 kg/cmÂ²", logic: "Auto Start" } ],
                "P-2017A/B": [ { reason: "å‡ºå£ä½å£“åŠ›", tag: "PSL-709", value: "5 kg/cmÂ²", logic: "Auto Start" } ],
                "P-2021A/B": [ { reason: "æ»‘æ²¹ä½ä½å£“åŠ›", tag: "PSLL-813B/815B", value: "0.7 kg/cmÂ²", logic: "Delay 60s" } ]
            }
        };

        const appDiv = document.getElementById('display-area');
        let currentZoom = 1;

        // é¦–é æ¸²æŸ“
        function renderHome() {
            let html = '<div class="vertical-menu">';
            
            // æœå°‹é¸é …
            html += `<button class="btn" onclick="renderSearchPage()">
                        <div class="btn-icon">ğŸ”</div>
                        <div class="btn-text">æœå°‹è³‡æ–™ (Search)</div>
                        <div class="arrow">âœ</div>
                     </button>`;

            // Master Map é¸é …
            html += `<button class="btn" onclick="renderMasterMap()">
                        <div class="btn-icon">ğŸ•¸ï¸</div>
                        <div class="btn-text">é€£é–å› æœç¸½è¡¨ (Master Map)</div>
                        <div class="arrow">âœ</div>
                     </button>`;

            // è¨­å‚™åˆ†é¡é¸é …
            const icons = { 'Compressor': 'âš™ï¸', 'Furnace': 'ğŸ”¥', 'Pump': 'ğŸ’§' };
            Object.keys(db).forEach(category => {
                html += `<button class="btn" onclick="renderCategory('${category}')">
                            <div class="btn-icon">${icons[category]}</div>
                            <div class="btn-text">${category}</div>
                            <div class="arrow">âœ</div>
                         </button>`;
            });
            html += '</div>';
            appDiv.innerHTML = html;
        }

        // æœå°‹é é¢
        function renderSearchPage() {
            let html = `<button class="btn btn-back" onclick="renderHome()"> â† è¿”å›ä¸»é¸å–® </button>`;
            html += `<h2 style="text-align:center;">å¿«é€Ÿæœå°‹</h2>`;
            html += `<input type="text" id="searchInput" class="search-box" placeholder="è¼¸å…¥ä½è™Ÿã€è¨­å‚™åæˆ–æ•¸å€¼ (å¦‚ 2002, å£“åŠ›)..." onkeyup="performSearch()">`;
            html += `<div id="searchResults"></div>`;
            appDiv.innerHTML = html;
            document.getElementById('searchInput').focus();
        }

        // æœå°‹é‚è¼¯
        function performSearch() {
            const query = document.getElementById('searchInput').value.toUpperCase();
            const resultsDiv = document.getElementById('searchResults');
            if (query.length < 2) {
                resultsDiv.innerHTML = '<div style="text-align:center; color:#999;">è«‹è¼¸å…¥è‡³å°‘2å€‹å­—å…ƒ...</div>';
                return;
            }

            let matches = [];
            
            Object.keys(db).forEach(cat => {
                Object.keys(db[cat]).forEach(equip => {
                    // æª¢æŸ¥è¨­å‚™åç¨±
                    if (equip.includes(query)) {
                        matches.push({ type: 'Equipment', name: equip, info: 'è¨­å‚™æœ¬èº«ç¬¦åˆ' });
                    }
                    // æª¢æŸ¥å…§éƒ¨è©³ç´°æ•¸æ“š
                    db[cat][equip].forEach(item => {
                        if ((item.reason && item.reason.includes(query)) || 
                            (item.tag && item.tag.includes(query)) ||
                            (item.value && item.value.includes(query))) {
                            matches.push({ 
                                type: 'Detail', 
                                name: equip, 
                                info: `${item.reason} <br> <span class="tag-no">${item.tag}</span>` 
                            });
                        }
                    });
                });
            });

            if (matches.length === 0) {
                resultsDiv.innerHTML = '<div style="text-align:center; color:#999;">æŸ¥ç„¡è³‡æ–™</div>';
            } else {
                let html = '';
                matches.forEach(m => {
                    html += `<div class="search-result-item" onclick="jumpToEquipment('${m.name}')">
                                <div style="font-weight:bold; color:var(--text-highlight);">${m.name}</div>
                                <div style="font-size:0.9rem; color:#666;">${m.info}</div>
                             </div>`;
                });
                resultsDiv.innerHTML = html;
            }
        }

        // æœå°‹è·³è½‰è¼”åŠ©
        function jumpToEquipment(equipName) {
            // åæŸ¥é¡åˆ¥
            let foundCat = '';
            Object.keys(db).forEach(cat => {
                if (db[cat][equipName]) foundCat = cat;
            });
            if (foundCat) renderDetails(foundCat, equipName);
        }

        // Master Map æ¸²æŸ“ (åŠ å…¥ç¸®æ”¾åŠŸèƒ½)
        function renderMasterMap() {
            currentZoom = 1;
            let html = `<button class="btn btn-back" onclick="renderHome()"> â† è¿”å›ä¸»é¸å–® </button>`;
            html += `<h2 style="text-align:center;">é€£é–å› æœé—œä¿‚åœ–</h2>`;
            
            html += `<div class="map-controls">
                        <button class="zoom-btn" onclick="zoomMap(0.2)">+</button>
                        <button class="zoom-btn" onclick="zoomMap(-0.2)">-</button>
                     </div>`;

            html += `
            <div class="mermaid-container">
                <div class="mermaid" id="mermaid-graph" style="transform-origin: top center; transition: transform 0.3s;">
                    graph TD
                        subgraph CAUSES [è·³è»Šä¸»å› ä¾†æº]
                            F2001[F-2001 S/D] -->|é€£é–| C2002
                            F2002[F-2002 S/D] -->|é€£é–| C2002
                            APH[APH S/D] -->|é€£é–| C2002
                            MCC[MCC 480V è·³é›»] -->|Delay 3s| C2002
                        end

                        subgraph MAIN [æ ¸å¿ƒå—å½±éŸ¿]
                            C2002((C-2002 S/D))
                        end

                        subgraph DOWNSTREAM [ä¸‹æ¸¸é€£é–æ•ˆæ‡‰]
                            C2005_Trig[C-2005 å£“å·®é«˜ PDSLL-733] -->|è¨Šè™Ÿè§¸ç™¼| XV941[é–‹å•Ÿ XV-941]
                            XV941 -->|5ç§’æœªå…¨é–‹| C2005[C-2005 S/D]
                            C2004_L[C-2004 æ¶²ä½ä½ LSLL-429] -->|é€£é–| C2004[C-2004 S/D]
                            P2001[P-2001 A/B S/D] -.->|è£½ç¨‹å½±éŸ¿| C2002
                        end

                        classDef trip fill:#feb2b2,stroke:#e53e3e,stroke-width:2px,color:#742a2a;
                        classDef equip fill:#fff,stroke:#667eea,stroke-width:2px;
                        
                        class C2002,F2001,F2002,APH,MCC,C2005,C2004,P2001 trip;
                </div>
            </div>`;
            
            appDiv.innerHTML = html;
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        }

        function zoomMap(delta) {
            currentZoom += delta;
            if (currentZoom < 0.5) currentZoom = 0.5;
            if (currentZoom > 3) currentZoom = 3;
            document.getElementById('mermaid-graph').style.transform = `scale(${currentZoom})`;
        }

        // åˆ†é¡åˆ—è¡¨
        function renderCategory(category) {
            let html = `<button class="btn btn-back" onclick="renderHome()"> â† è¿”å›ä¸»é¸å–® </button>`;
            html += `<h2 style="text-align:center;">${category} åˆ—è¡¨</h2>`;
            html += '<div class="vertical-menu">';
            
            Object.keys(db[category]).forEach(equipment => {
                html += `<button class="btn" onclick="renderDetails('${category}', '${equipment}')">
                            <div class="btn-text">${equipment}</div>
                            <div class="arrow">âœ</div>
                         </button>`;
            });
            
            html += '</div>';
            appDiv.innerHTML = html;
        }

        // è©³ç´°æ•¸æ“š
        function renderDetails(category, equipment) {
            const data = db[category][equipment];
            let html = `<button class="btn btn-back" onclick="renderCategory('${category}')"> â† è¿”å› ${category} </button>`;
            
            html += `<div class="detail-card">`;
            html += `<h3 style="color:var(--text-highlight); border-bottom: 2px solid var(--accent-color); padding-bottom:10px;">
                        ${equipment} è·³è»Šå› ç´ 
                     </h3>`;
            
            html += `<table>
                        <thead>
                            <tr>
                                <th width="40%">è·³è»Šå› ç´ </th>
                                <th width="30%">Tag / Set</th>
                                <th width="30%">å‚™è¨»</th>
                            </tr>
                        </thead>
                        <tbody>`;
            
            data.forEach(item => {
                html += `<tr>
                            <td>${item.reason}</td>
                            <td>
                                <span class="tag-no">${item.tag}</span>
                                <span class="value">${item.value}</span>
                            </td>
                            <td>${item.logic}</td>
                         </tr>`;
            });

            html += `</tbody></table></div>`;
            appDiv.innerHTML = html;
        }

        renderHome();
    </script>
</body>
</html>
